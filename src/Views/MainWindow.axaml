<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:X4PlayerShipTradeAnalyzer.ViewModels"
    xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
    xmlns:conv="clr-namespace:X4PlayerShipTradeAnalyzer.Converters"
    xmlns:mdv="clr-namespace:MarkdownViewer.Core.Controls;assembly=MarkdownViewer.Core"
    x:Class="X4PlayerShipTradeAnalyzer.Views.MainWindow"
  Width="1200" Height="800"
  Title="X4 Player Ship Trade Analyzer">
  <Window.Resources>
    <conv:NullToUnsetBrushConverter x:Key="NullToUnsetBrush" />
  <conv:ZeroToRedBrushConverter x:Key="ZeroToRed" />
  <conv:ZeroToRedIfEnabledConverter x:Key="ZeroToRedIfEnabled" />
  <conv:EnumEqualsConverter x:Key="EnumEquals" />
  </Window.Resources>
  <Window.Styles>
    <Style Selector="TextBlock.RightAligned">
      <Setter Property="TextAlignment" Value="Right"/>
      <Setter Property="HorizontalAlignment" Value="Right"/>
    </Style>
    <Style Selector="TextBlock.RightAlignedPadded" >
      <Setter Property="TextAlignment" Value="Right"/>
      <Setter Property="HorizontalAlignment" Value="Right"/>
      <Setter Property="Padding" Value="8"/>
    </Style>
  </Window.Styles>

  <Design.DataContext>
    <vm:MainViewModel baseDir="."/>
  </Design.DataContext>

  <TabControl Grid.Row="1" x:Name="MainTabs" SelectionChanged="MainTabs_SelectionChanged">
    <!-- Parent: By Transactions -->
    <TabItem Header="By Transactions" x:Name="ByTransactionsTab">
      <TabControl x:Name="ByTransactionsTabs">
        <TabItem Header="Ships Transactions" x:Name="ShipsTransactionsTab">
          <Grid DataContext="{Binding ShipsDataTransactions}">
          <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
              <RowDefinition Height="28" />
              <RowDefinition Height="36" />
              <RowDefinition />
          </Grid.RowDefinitions>
          <Border Grid.Row="0" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
              <CheckBox Content="Container" Margin="0,0,8,0" IsChecked="{Binding IsContainerChecked, Mode=TwoWay}"/>
              <CheckBox Content="Solid" IsChecked="{Binding IsSolidChecked, Mode=TwoWay}"/>
            </StackPanel>
          </Border>
          <!-- Row 0, Column 1: summary values -->
          <Border Grid.Row="0" Grid.Column="1" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Spacing="24">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Ship:"/>
                <TextBlock Text="{Binding SelectedShip.ShipName}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Total Profit:"/>
                <TextBlock Text="{Binding TotalProfit}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Items Traded:"/>
                <TextBlock Text="{Binding ItemsTraded}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Time in Service:"/>
                <TextBlock Text="{Binding TimeInService}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Elapsed Time (Buyâ†’Sell):"/>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Min:"/>
                  <TextBlock Text="{Binding TimeMin}" FontWeight="Bold"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Avg:"/>
                  <TextBlock Text="{Binding TimeAvg}" FontWeight="Bold"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Max:"/>
                  <TextBlock Text="{Binding TimeMax}" FontWeight="Bold"/>
                </StackPanel>
              </StackPanel>
            </StackPanel>
          </Border>

          <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <StackPanel Orientation="Horizontal" Spacing="6" Margin="16,0,0,0">
              <TextBlock Text="Sort:" VerticalAlignment="Center"/>
              <RadioButton Content="Name" GroupName="ShipsSort" Margin="8,0,0,0"
                            IsChecked="{Binding ShipsSortOrder, Mode=TwoWay, Converter={StaticResource EnumEquals}, ConverterParameter=Name}"/>
              <RadioButton Content="Profit" GroupName="ShipsSort" Margin="8,0,0,0"
                            IsChecked="{Binding ShipsSortOrder, Mode=TwoWay, Converter={StaticResource EnumEquals}, ConverterParameter=Profit}"/>
            </StackPanel>
          </Border>

          <Border Grid.Row="2" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <ListBox ItemsSource="{Binding ShipList}"
                    SelectedItem="{Binding SelectedShip, Mode=TwoWay}"
                    Margin="8" Width="340">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <Grid ColumnDefinitions="*,8,Auto">
                    <TextBlock Grid.Column="0" Text="{Binding ShipName}" ToolTip.Tip="{Binding ShipName}"/>
                    <TextBlock Grid.Column="2" Text="{Binding EstimatedProfit, StringFormat=N2}" FontWeight="SemiBold" Classes="RightAligned"  Margin="0"/>
                  </Grid>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </Border>

          <Border Grid.Row="1" Grid.RowSpan="2" Grid.Column="1" BorderBrush="Gray" BorderThickness="0" Padding="4">

            <DataGrid ItemsSource="{Binding FilteredTransactions}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Margin="8">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Time" Binding="{Binding Time}" Width="100"/>
                <DataGridTextColumn Header="Sector" Binding="{Binding Sector}" Width="180"/>
                <DataGridTextColumn Header="Station" Binding="{Binding Station}" Width="400"/>
                <DataGridTextColumn Header="Operation" Binding="{Binding Operation}" Width="100"/>
                <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="240"/>
                <DataGridTemplateColumn Header="Price" SortMemberPath="Price" Width="100">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Price, StringFormat=N2}" Classes="RightAlignedPadded" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="Quantity" SortMemberPath="Quantity" Width="100">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Quantity, StringFormat=N0}" Classes="RightAlignedPadded" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="Total" SortMemberPath="Total" Width="100">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Total, StringFormat=N2}" Classes="RightAlignedPadded" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="Estimated Profit" SortMemberPath="EstimatedProfit" Width="140">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding EstimatedProfit, StringFormat=N2}" Classes="RightAlignedPadded" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>

          </Border>
          </Grid>
        </TabItem>

        <TabItem Header="Ships Graphs" x:Name="ShipsTransactionsGraphsTab">
          <Grid DataContext="{Binding ShipsGraphs}">
              <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>
              <Grid.RowDefinitions>
                  <RowDefinition Height="28" />
                  <RowDefinition />
              </Grid.RowDefinitions>
              <!-- Filters row -->
              <Border Grid.Row="0" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                  <CheckBox Content="Container" Margin="0,0,8,0" IsChecked="{Binding IsContainerChecked, Mode=TwoWay}"/>
                  <CheckBox Content="Solid" IsChecked="{Binding IsSolidChecked, Mode=TwoWay}"/>
                </StackPanel>
              </Border>
              <Border Grid.Row="1" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
                <ListBox ItemsSource="{Binding ShipList}"
                    Margin="8" Width="300"
                    DoubleTapped="ShipGraphsList_DoubleTapped">
                          <ListBox.ItemTemplate>
                            <DataTemplate>
                  <TextBlock Text="{Binding ShipName}"
                     FontWeight="{Binding FontWeight}"
                     Foreground="{Binding GraphBrush, Converter={StaticResource NullToUnsetBrush}}" />
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>
              </Border>
              <Border Grid.Row="0" Grid.Column="1" Grid.RowSpan="2" BorderBrush="Gray" BorderThickness="0" Padding="8">
                <lvc:CartesianChart Series="{Binding Series}"
                                    XAxes="{Binding XAxes}"
                                    YAxes="{Binding YAxes}"/>
              </Border>
          </Grid>
        </TabItem>

        <TabItem Header="Wares Stats" x:Name="WaresStatsTab">
          <Grid DataContext="{Binding WaresStats}">
            <Grid.RowDefinitions>
              <RowDefinition Height="28" />
              <RowDefinition />
            </Grid.RowDefinitions>
            <!-- Filters row -->
            <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                <CheckBox Content="Container" Margin="0,0,8,0" IsChecked="{Binding IsContainerChecked, Mode=TwoWay}"/>
                <CheckBox Content="Solid" IsChecked="{Binding IsSolidChecked, Mode=TwoWay}"/>
              </StackPanel>
            </Border>
            <!-- Chart + custom legend -->
            <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="0" Padding="8">
              <Grid ColumnDefinitions="* , Auto" >
                <lvc:CartesianChart Grid.Column="0"
                                    Series="{Binding Series}"
                                    XAxes="{Binding XAxes}"
                                    YAxes="{Binding YAxes}"
                                    LegendPosition="Hidden"/>

                <!-- Custom legend: ware color + name -->
                <ScrollViewer Grid.Column="1" Margin="12,0,0,0" Width="280" VerticalScrollBarVisibility="Auto">
                  <ItemsControl ItemsSource="{Binding Legend}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4">
                          <Border Width="16" Height="16" Background="{Binding Brush}" CornerRadius="2"/>
                          <TextBlock Text="{Binding Name}" />
                        </StackPanel>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </ScrollViewer>
              </Grid>
            </Border>
          </Grid>
        </TabItem>
      </TabControl>
    </TabItem>

    <!-- Parent: By Trades -->
    <TabItem Header="By Trades" x:Name="ByTradesTab">
      <TabControl x:Name="ByTradesTabs">
        <TabItem Header="Ships Trades" x:Name="ShipsTradesTab">
          <Grid DataContext="{Binding ShipsDataTrades}">
          <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
              <RowDefinition Height="28" />
              <RowDefinition Height="36" />
              <RowDefinition />
          </Grid.RowDefinitions>

          <Border Grid.Row="0" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
              <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="24">
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <CheckBox Content="With Internal Trades" IsChecked="{Binding WithInternalTrades, Mode=TwoWay}"/>
                </StackPanel>
              </StackPanel>
          </Border>
          <!-- Filters / summary row -->
          <Border Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Spacing="24">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Ship:"/>
                <TextBlock Text="{Binding SelectedShip.ShipName}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Total Profit:"/>
                <TextBlock Text="{Binding TotalProfit}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Items Traded:"/>
                <TextBlock Text="{Binding ItemsTraded}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Time in Service:"/>
                <TextBlock Text="{Binding TimeInService}" FontWeight="Bold"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="Trade Time:"/>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Min:"/>
                  <TextBlock Text="{Binding TimeMin}" FontWeight="Bold"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Avg:"/>
                  <TextBlock Text="{Binding TimeAvg}" FontWeight="Bold"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="Max:"/>
                  <TextBlock Text="{Binding TimeMax}" FontWeight="Bold"/>
                </StackPanel>
              </StackPanel>
            </StackPanel>
          </Border>

          <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" BorderBrush="Gray" BorderThickness="0" Padding="4">

            <StackPanel Orientation="Horizontal" Spacing="6" Margin="16,0,0,0">
              <TextBlock Text="Sort:" VerticalAlignment="Center"/>
              <RadioButton Content="Name" GroupName="ShipsSort" Margin="8,0,0,0"
                            IsChecked="{Binding ShipsSortOrder, Mode=TwoWay, Converter={StaticResource EnumEquals}, ConverterParameter=Name}"/>
              <RadioButton Content="Profit" GroupName="ShipsSort" Margin="8,0,0,0"
                            IsChecked="{Binding ShipsSortOrder, Mode=TwoWay, Converter={StaticResource EnumEquals}, ConverterParameter=Profit}"/>
            </StackPanel>
          </Border>

          <!-- Left: ships list -->
          <Border Grid.Row="2" Grid.Column="0" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <ListBox ItemsSource="{Binding ShipList}"
                    SelectedItem="{Binding SelectedShip, Mode=TwoWay}"
                    Margin="8" Width="340">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <Grid ColumnDefinitions="*,8,Auto">
                    <TextBlock Grid.Column="0" Text="{Binding ShipName}" ToolTip.Tip="{Binding ShipName}"/>
                    <TextBlock Grid.Column="2" Text="{Binding EstimatedProfit, StringFormat=N2}" FontWeight="SemiBold" Classes="RightAligned"  Margin="0"/>
                  </Grid>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </Border>

  <!-- Middle: full trades grid -->
          <Border Grid.Row="1" Grid.RowSpan="2" Grid.Column="1" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <DataGrid ItemsSource="{Binding FilteredFullTrades}"
                      SelectedItem="{Binding SelectedFullTrade, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Margin="8">
              <DataGrid.Columns>
              <DataGridTextColumn Header="Time" Binding="{Binding Time}" Width="90"/>
              <DataGridTextColumn Header="Ware" Binding="{Binding WareName}" Width="200"/>
              <DataGridTemplateColumn Header="Bought" SortMemberPath="BoughtVolume" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding BoughtVolume, StringFormat=N0}" Classes="RightAlignedPadded" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Sold" SortMemberPath="SoldVolume" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding SoldVolume, StringFormat=N0}" Classes="RightAlignedPadded" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Profit" SortMemberPath="Profit" Width="120">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Profit, StringFormat=N2}" Classes="RightAlignedPadded" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTextColumn Header="Spent Time" Binding="{Binding SpentTime}" Width="100"/>
              </DataGrid.Columns>
            </DataGrid>
          </Border>

  <!-- Right: combined steps grid -->
          <Border Grid.Row="1" Grid.RowSpan="2" Grid.Column="2" BorderBrush="Gray" BorderThickness="0" Padding="4">
            <DataGrid ItemsSource="{Binding TradeSteps}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Margin="8">
              <DataGrid.Columns>
              <DataGridTextColumn Header="Time" Binding="{Binding Time}" Width="90"/>
              <DataGridTextColumn Header="Op." Binding="{Binding Operation}" Width="60"/>
              <DataGridTemplateColumn Header="Vol."  SortMemberPath="Volume" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Volume, StringFormat=N0}" Classes="RightAlignedPadded"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Price" SortMemberPath="Price" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Price, StringFormat=N2}" Classes="RightAlignedPadded" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Sector" SortMemberPath="Sector" Width="140">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Sector}" ToolTip.Tip="{Binding Sector}" Margin="8"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Station" SortMemberPath="Station" Width="Auto">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Station}" ToolTip.Tip="{Binding Station}" Margin="8"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>
          </Border>
          </Grid>
        </TabItem>
      </TabControl>
    </TabItem>
    <TabItem Header="Configuration" x:Name="ConfigurationTab">
      <Grid DataContext="{Binding Configuration}" Margin="12">
        <Grid.RowDefinitions>
          <!-- Game folder row -->
          <RowDefinition Height="Auto"/>
          <!-- Small gap below game folder -->
          <RowDefinition Height="8"/>
          <!-- Game-data statistics row -->
          <RowDefinition Height="Auto"/>
          <!-- Big separation between blocks -->
          <RowDefinition Height="32"/>
          <!-- Game save path row -->
          <RowDefinition Height="Auto"/>
          <!-- Small gap below save path -->
          <RowDefinition Height="8"/>
          <!-- Save-data statistics row -->
          <RowDefinition Height="Auto"/>
          <!-- Gap before theme selector -->
          <RowDefinition Height="8"/>
          <!-- Theme selector row -->
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="160"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="12"/>
          <!-- New column for Load Only Game Language checkbox -->
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="12"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="12"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Wares + Language statistics row (each stat on its own line) -->
        <Border Grid.Row="2" Grid.ColumnSpan="7" BorderBrush="Gray" BorderThickness="0 0 0 1" Padding="0 0 0 8">
          <StackPanel Orientation="Vertical" Spacing="6">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Languages:" />
              <TextBlock Text="{Binding LanguagesCount}" FontWeight="Bold" Foreground="{Binding LanguagesCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Texts ( " Foreground="{Binding CurrentLanguageTextCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="Language Id: "/>
              <TextBlock Text="{Binding CurrentLanguageId}" FontWeight="Bold" Foreground="{Binding CurrentLanguageId, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="):" Foreground="{Binding CurrentLanguageTextCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding CurrentLanguageTextCount}" FontWeight="Bold" Foreground="{Binding CurrentLanguageTextCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Wares:" Foreground="{Binding WaresCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding WaresCount}" FontWeight="Bold" Foreground="{Binding WaresCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Factions:" Foreground="{Binding FactionsCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding FactionsCount}" FontWeight="Bold" Foreground="{Binding FactionsCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Cluster/Sector names:" Foreground="{Binding ClusterSectorNamesCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding ClusterSectorNamesCount}" FontWeight="Bold" Foreground="{Binding ClusterSectorNamesCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Game Folder (X4.exe) -->
        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="Game Folder"/>
        <TextBlock Grid.Row="0" Grid.Column="1" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Text="{Binding GameFolderExePath}"/>
        <Button Grid.Row="0" Grid.Column="2" Content="Set" Click="SetGameFolder_Click"/>
  <CheckBox Grid.Row="0" Grid.Column="4" Content="Load Only Game Language" IsChecked="{Binding LoadOnlyGameLanguage, Mode=TwoWay}" VerticalAlignment="Center"/>
  <Button Grid.Row="0" Grid.Column="6" Content="Load Game Data" IsEnabled="{Binding CanReloadGameData}" Click="ReloadGameData_Click"/>

        <!-- Theme selector -->
        <TextBlock Grid.Row="8" Grid.Column="0" VerticalAlignment="Center" Text="Theme"/>
        <ComboBox Grid.Row="8" Grid.Column="1" Width="200"
            SelectedItem="{Binding AppTheme, Mode=TwoWay}">
          <x:String>System</x:String>
          <x:String>Light</x:String>
          <x:String>Dark</x:String>
        </ComboBox>

  <!-- Save-data statistics table (each stat on its own line) -->
        <Border Grid.Row="6" Grid.ColumnSpan="7" BorderBrush="Gray" BorderThickness="0 0 0 1" Padding="8 0 0 8">
          <StackPanel Orientation="Vertical" Spacing="6">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Player ships:" Foreground="{Binding PlayerShipsCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding PlayerShipsCount}" FontWeight="Bold" Foreground="{Binding PlayerShipsCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Stations:" Foreground="{Binding StationsCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding StationsCount}" FontWeight="Bold" Foreground="{Binding StationsCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Removed objects:">
                <TextBlock.Foreground>
                  <MultiBinding Converter="{StaticResource ZeroToRedIfEnabled}">
                    <Binding Path="RemovedObjectCount"/>
                    <Binding Path="LoadRemovedObjects"/>
                  </MultiBinding>
                </TextBlock.Foreground>
              </TextBlock>
              <TextBlock Text="{Binding RemovedObjectCount}" FontWeight="Bold">
                <TextBlock.Foreground>
                  <MultiBinding Converter="{StaticResource ZeroToRedIfEnabled}">
                    <Binding Path="RemovedObjectCount"/>
                    <Binding Path="LoadRemovedObjects"/>
                  </MultiBinding>
                </TextBlock.Foreground>
              </TextBlock>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="Trades:" Foreground="{Binding TradesCount, Converter={StaticResource ZeroToRed}}"/>
              <TextBlock Text="{Binding TradesCount}" FontWeight="Bold" Foreground="{Binding TradesCount, Converter={StaticResource ZeroToRed}}"/>
            </StackPanel>
          </StackPanel>
        </Border>

              <!-- Game Save Path -->
  <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="Game Save Path"/>
  <TextBlock Grid.Row="4" Grid.Column="1" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Text="{Binding GameSavePath}"/>
  <Button Grid.Row="4" Grid.Column="2" Content="Set" Click="SetSaveFolder_Click"/>
  <!-- Option checkbox before Load Save button -->
  <CheckBox Grid.Row="4" Grid.Column="4" Content="Load removed objects" IsChecked="{Binding LoadRemovedObjects, Mode=TwoWay}" VerticalAlignment="Center"/>
  <Button Grid.Row="4" Grid.Column="6" Content="Load Save Data" IsEnabled="{Binding CanReloadSaveData}" Click="ReloadSaveData_Click"/>
      </Grid>
    </TabItem>

    <TabItem Header="Readme" x:Name="ReadmeTab">
      <Grid>
        <ScrollViewer Margin="8" VerticalScrollBarVisibility="Auto" x:Name="ReadmeScrollViewer"/>
      </Grid>
    </TabItem>
  </TabControl>
</Window>
